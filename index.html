<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Eye track</title>
    <meta name="description" content="Track eyes">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Place favicon.ico in the root directory -->

        <!-- <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
        <script src="js/vendor/modernizr-2.8.3.min.js"></script> -->
        <style>
            #heatmap-toggle{
                position: absolute;
                top: 0;
                left: 0;
                background-color: rgba(200, 0, 0, .5);
                z-index: 100;
            }
        </style>
    </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
            <![endif]-->

            <!-- Add your site or application content here -->
            <a id="heatmap-toggle">Toogle Heatmap</a>
            <div style="height: 1000px" id="heatmap-container">
                <iframe src="https://h5p.org/h5p/embed/15103" frameborder="0" allowfullscreen="allowfullscreen"></iframe><script src="https://h5p.org/sites/all/modules/h5p/library/js/h5p-resizer.js" charset="UTF-8"></script>
            </div>

        <!-- <script src="https://code.jquery.com/jquery-1.12.2.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.12.2.min.js"><\/script>')</script> -->
        <script src="webgazer.js"></script>
        <script src="heatmap.min.js"></script>
        <script src="https://h5p.org/sites/all/modules/h5p/library/js/h5p-resizer.js" charset="UTF-8"></script>
        <script>
            window.heatmapDisplay = false;
            window.onload = function() {
                webgazer.setRegression('ridge') /* currently must set regression and tracker */
                .setTracker('clmtrackr')
                .setGazeListener(function(data, clock) {
                    var allData = JSON.parse(window.localStorage.getItem('data'));
                    allData.push({clock, data});
                    window.localStorage.setItem('data', JSON.stringify(allData));
                 })
                .begin()
                .showPredictionPoints(false); /* shows a square every 100 milliseconds where current prediction is */

                var heatmapToggle = document.getElementById('heatmap-toggle');
                heatmapToggle.addEventListener('click', function(e){
                    e.preventDefault();
                    var heatmapContainer = document.getElementById('heatmap-container');
                    if(!window.heatmapDisplay){
                        window.heatmap = h337.create({
                            container: heatmapContainer
                        });
                        var rawMapData = JSON.parse(window.localStorage.getItem('data'));
                        var mapData = rawMapData
                            .filter(function(obj){
                                return (obj.data !== null);
                            })
                            .map(function(obj){
                                var cleanNode = {x: obj.data.x, y: obj.data.y};
                                return cleanNode;
                            })
                            .map(function(obj){
                                obj.value = 1;
                                return obj;
                            });
                        heatmap.setData({
                            max:    1,
                            data:   mapData
                        });
                    }
                    else{
                        window.heatmap.setData({
                            data: []
                        });
                        heatmapContainer.style = "";
                        document.getElementsByClassName('heatmap-canvas')[0].remove();
                    }
                    window.heatmapDisplay = !heatmapDisplay;

                });

                var setup = function() {
                    window.localStorage.setItem('data', JSON.stringify([]));
                };

                function checkIfReady() {
                    if (webgazer.isReady()) {
                        setup();
                    } else {
                        setTimeout(checkIfReady, 100);
                    }
                }
                setTimeout(checkIfReady,100);
            };

    </script>

</body>
</html>